# ~validate 命令 - 验证知识库

本模块定义知识库和方案包验证的执行规则。

---

## 命令说明

```yaml
命令: ~validate
类型: 范围选择类
功能: 按照执行流程验证知识库和方案包质量，可选择验证范围（全部/仅知识库/仅方案包），只读操作
```

---

## 执行模式适配

> 📌 规则引用: 按 G4 路由架构及 G5 执行模式规则执行

<mode_adaptation>
~validate 模式适配规则:
1. 本命令为独立工具命令，不受 WORKFLOW_MODE 影响
2. 评估深度: 轻量评估（无评分追问）
3. 为只读操作，不修改任何文件
4. 无参数时需用户选择验证范围
5. 发现问题时提供修复方案选项
</mode_adaptation>

---

## 执行流程

> 📌 规则引用: 脚本路径、存在性检查、错误恢复规则见 references/rules/tools.md

### 步骤1: 轻量评估

```yaml
执行规则: 按 G4 "需求评估规则"执行（轻量评估），按G3场景内容规则（需求评估场景）输出
```

### 步骤2: 确定验证范围

```yaml
执行内容:
  - 无参数时询问用户选择
  - 支持: 全部/仅知识库/仅方案包

按G3场景内容规则（确认场景）输出，见"用户选择处理 - 验证范围选择"
```

### 步骤3: 执行验证

<validation_check>
验证分析步骤:
1. 检查核心文件存在性和完整性
2. 对比文档与代码的接口/数据模型一致性
3. 扫描空文件、死链、格式问题
4. 检测敏感信息泄露风险
5. 按严重程度分级问题（Critical/Warning/Info）
</validation_check>

```yaml
验证知识库（如在范围内）:
  完整性: 核心文件存在性、模块覆盖率
  一致性: 文档与代码的接口/数据模型对比
  章节完整性:
    - modules/{模块}.md: 职责、行为规范、依赖关系（必须）；接口定义（可选）
    - context.md: 基本信息、技术上下文、项目概述、开发约定、当前约束（必须）；技术债务（可选）
    - proposal.md: 元信息、需求、方案（必须）；技术设计、核心场景、技术决策（可选）
  质量: 空文件、死链、格式问题
  安全: 敏感信息扫描

验证方案包（如在范围内）:
  脚本调用: validate_package.py [<package-name>]
  验证内容:
    完整性: proposal.md + tasks.md 存在且非空
    结构: 目录命名、任务状态符号
    质量: 描述清晰度、任务粒度

输出报告:
  - 按严重程度分级（Critical/Warning/Info）
  - 提供修复建议
```

### 步骤4: 后续操作

```yaml
有问题时: 按G3场景内容规则（确认场景）输出，见"用户选择处理 - 验证问题处理"

目录/文件创建: 按 G1 "目录/文件自动创建规则" 执行

完成后: 按 G6 状态重置协议执行
```

---

## 不确定性处理

- 知识库不存在 → 提示执行 ~init
- 方案包格式不识别 → 标注"未知格式"
- 一致性检查无法确定 → 标注"需人工确认"

---

## 用户选择处理

### 场景: 验证范围选择

```yaml
内容要素:
  - 可验证项: 知识库状态、方案包状态
  - 范围说明: 各选项的验证内容说明

选项:
  全部: 验证知识库和方案包
  仅知识库: 只验证知识库完整性和一致性
  仅方案包: 只验证方案包结构和质量
  取消: 按 G6 状态重置协议执行
```

### 场景: 验证问题处理

```yaml
内容要素:
  - 验证报告: 按严重程度分级的问题列表（Critical/Warning/Info）
  - 问题摘要: 问题数量和类型统计
  - 修复建议: 各问题的建议修复方式

选项:
  自动修复: 修复格式问题（需 KB_CREATE_MODE≠0）
  生成修复方案: 创建修复方案包
  仅记录: 保存验证报告（需 KB_CREATE_MODE≠0）
  跳过: 不执行操作，按 G6 状态重置协议执行
```
