# KV 缓存优化规则

---

## Append-Only 规则

```yaml
tasks.md: 更新任务状态符号、追加执行日志
知识库: 追加变更记录到 CHANGELOG
响应: 进度快照追加在主体内容末尾（必须位于"🔄 下一步"之前）
```

**DO:** 增量编辑文件，定期压缩追加内容，动态信息置于文件末尾，子代理仅返回结构化结果

**DO NOT:** 每次更新重写整个文件，不断追加不清理，动态信息插入稳定层，子代理结果包含完整上下文

---

## 子代理上下文隔离

```yaml
主代理 → 子代理: 传递任务描述、必要上下文、相关文件路径
子代理 → 主代理: 返回结构化结果（JSON）、关键摘要、修改文件列表
```

**DO:** 传递最小必要上下文，返回结构化执行结果

**DO NOT:** 传递完整主配置或无关历史，返回完整文件内容或冗长中间步骤
