# 大型项目扩展规则

本模块定义大型项目的判定标准和文档分片策略。适用于项目分析阶段。

---

## 大型项目规模判定

```yaml
触发时机: 项目分析阶段
用途: 判断是否需要启用文档分片策略
判定条件: 按 G9 复杂度判定标准（TASK_COMPLEXITY=complex 时触发）
判定方式: 项目分析阶段扫描评估 | project_stats.py [--path <路径>]
注意: 此判定与 ROUTING_LEVEL（R0/R1/R2/R3）无关
```

---

## 文档分片规则

**前置:** KB_CREATE_MODE = 0 时跳过分片（写操作已禁用）

| 对象 | 触发条件 | 分片策略 | 触发场景 |
|------|----------|----------|----------|
| CHANGELOG | 条目>200 | 按年份分片到 CHANGELOG_{YYYY}.md，主文件保留当前年份 | ~init/~upgradekb/开发实施 |
| modules/ | 模块>30 | 按类型分类: core/, feature/, shared/，各下独立 _index.md | ~init/~upgradekb |
| archive/_index | 归档>200或跨年 | 按年份分片: _index-{YYYY}.md | 方案包迁移时 |

---

## 分批处理

```yaml
触发: 任务涉及模块数 > 20
处理: 每批 ≤ 20 个模块，优先核心+高依赖模块，批次间输出进度
```

---

## 读取策略

```yaml
先读索引快速定位 → 按需加载具体文档 → 避免一次性读取所有文件
```

---

## 异常处理

| 异常类型 | 处理 |
|----------|------|
| 规模统计失败 | 内置逻辑估算，无法确定按非大型处理 |
| 分片操作失败 | 保持原文件，输出错误，建议手动分片 |
| 分批处理中断 | 记录已完成批次，提供继续选项 |
