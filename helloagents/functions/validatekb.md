# ~validatekb 命令 - 验证知识库

本模块定义知识库和方案包验证的执行规则。

---

## 命令说明

```yaml
命令: ~validatekb
类型: 范围选择类
功能: 验证知识库和方案包质量，只读操作
评估: 需求理解 + EHRB 检测（不评分不追问）
```

---

## 执行模式适配

```yaml
规则:
  1. 独立工具命令，不受 WORKFLOW_MODE 影响
  2. 为只读操作，不修改任何文件
  3. 无参数时需用户选择验证范围
  4. 发现问题时提供修复方案选项
```

---

## 执行流程

### 步骤1: 需求理解 + EHRB 检测

```yaml
无独立输出，直接进入下一步
```

### 步骤2: 确定验证范围

```yaml
无参数时:
  输出: 确认（验证范围选择）
  ⛔ END_TURN
  用户确认后: 全部 / 仅知识库 / 仅方案包 / 取消(→状态重置)

有参数时:
  输出: 确认（验证范围: {指定范围}）
  ⛔ END_TURN
  用户确认后: 继续 / 取消(→状态重置)
```

### 步骤3: 执行验证

```yaml
验证知识库（如在范围内）:
  完整性: 核心文件存在性、模块覆盖率
  一致性: 默认检查结构一致性（模块是否对应）；用户要求深度检查时再对比接口/数据模型
  章节完整性:
    modules/{模块}.md: 职责、行为规范、依赖关系（必须）；接口定义（可选）
    context.md: 基本信息、技术上下文、项目概述、开发约定、当前约束（必须）；技术债务（可选）
    proposal.md: 元信息、需求、方案（必须）；技术设计、核心场景、技术决策（可选）
  质量: 空文件、死链、格式问题
  安全: 知识库文件中的敏感信息检查（密码、token、密钥等）

验证方案包（如在范围内）:
  脚本: validate_package.py [<package-name>]
  完整性: proposal.md + tasks.md 存在且非空
  结构: 目录命名、任务状态符号
  质量: 描述清晰度、任务粒度

输出: 报告（按 Critical/Warning/Info 分级+修复建议）
```

### 步骤4: 后续操作

```yaml
有问题时:
  输出: 确认（验证报告+问题摘要+修复建议）
  ⛔ END_TURN
  用户确认后:
  自动修复: 修复格式问题（需 KB_CREATE_MODE≠0）
  生成修复方案: 创建修复方案包
  仅记录报告: 保存验证报告（需 KB_CREATE_MODE≠0）
  跳过: 不执行操作

→ 状态重置
```

---

## 不确定性处理

| 场景 | 处理 |
|------|------|
| 知识库不存在 | 提示执行 ~init |
| 方案包格式不识别 | 标注"未知格式" |
| 一致性检查无法确定 | 标注"需人工确认" |
