# ~review 命令 - 代码审查

本模块定义代码审查的执行规则。

---

## 命令说明

```yaml
命令: ~review [<路径>]
类型: 范围选择类
功能: 代码审查，可选择审查范围（全部代码/最近修改/暂存区/指定路径）
评估: 需求理解 + EHRB 检测（不评分不追问）
```

---

## 执行模式适配

```yaml
规则:
  1. 独立工具命令，不受 WORKFLOW_MODE 影响
  2. 无参数时需用户选择审查范围
  3. 审查结果按严重程度分级
  4. 发现问题时提供优化方案选项
  5. 审查文件>5 时 [RLM:reviewer] 强制调用 [→ G10 调用通道]
```

---

## 执行流程

### 步骤1: 需求理解 + EHRB 检测

```yaml
无独立输出，直接进入下一步
```

### 步骤2: 确定审查范围

```yaml
无参数时:
  输出: 确认（审查范围选择）
  ⛔ END_TURN
  用户确认后: 全部代码 / 最近修改 / 暂存区 / 指定路径 / 取消(→状态重置)

有参数时:
  输出: 确认（审查范围: {路径}+文件数量）
  ⛔ END_TURN
  用户确认后: 继续 / 取消(→状态重置)
```

### 步骤3: 执行审查

```yaml
分析维度:
  质量: 代码复杂度、重复度、命名规范、注释覆盖率
  安全: 不安全函数、敏感信息硬编码、注入风险
  性能: 低效算法模式、资源泄漏风险

分析步骤:
  1. 评估复杂度（函数长度、嵌套层级、圈复杂度）
  2. 检测重复度和命名规范一致性
  3. 识别不安全函数和敏感信息
  4. 检测注入风险和低效算法
  5. 按严重程度分级（Critical/Warning/Info）

输出: 报告（文件路径+行号+修复建议）
```

### 步骤4: 后续操作

```yaml
有问题时:
  输出: 确认（审查结果摘要+问题列表+关键问题定位）
  ⛔ END_TURN
  用户确认后:
  生成优化方案: 创建 plan/YYYYMMDDHHMM_code-review/ 方案包
  仅记录报告: 输出完整报告
  跳过: 不执行操作

→ 状态重置
```

---

## 分析原则

```yaml
审查策略:
  - 测试文件降低安全检查严格度
  - 生成的代码/压缩代码跳过审查
  - 框架特定代码参考框架最佳实践
  - 复杂度难以判定时标注"需人工审查"
```

---

## 不确定性处理

| 场景 | 处理 |
|------|------|
| 文件类型无法识别 | 跳过审查，标注"未知类型" |
| 复杂度难以判定 | 标注"需人工审查" |
| 审查范围过大 | 建议缩小范围或分批审查 |
