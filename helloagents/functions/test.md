# ~test 命令 - 运行测试

本模块定义运行测试的执行规则。

---

## 命令说明

```yaml
命令: ~test
类型: 场景确认类
功能: 检测框架运行测试并分析结果
评估: 需求理解 + EHRB 检测（不评分不追问）
```

---

## 执行模式适配

```yaml
规则:
  1. 独立工具命令，不受 WORKFLOW_MODE 影响
  2. 自动检测测试框架，多框架时需用户选择
  3. 无法检测时请求用户提供测试命令
  4. 测试失败时提供修复方案选项
  5. 需要设计新测试用例时 [RLM:tester] 强制调用 [→ G10 调用通道]
```

---

## 执行流程

### 步骤1: 需求理解 + EHRB 检测

```yaml
无独立输出，直接进入下一步
```

### 步骤2: 扫描测试环境

```yaml
扫描: 优先读取项目配置文件（package.json/pyproject.toml 等）中的测试配置 → 不足时检查常见测试目录和文件命名模式

多框架共存: 询问用户选择
无法检测: 请求用户提供测试命令

输出: 确认（测试框架选择）
⛔ END_TURN
用户确认后: 选择框架N / 全部运行 / 输入测试命令 / 取消(→状态重置)
```

### 步骤3: 执行测试

```yaml
执行: 测试命令（带超时保护）→ 捕获输出和退出码

结果分析:
  1. 解析通过/失败/跳过统计
  2. 提取失败测试的文件路径和行号
  3. 分析错误信息确定失败原因
  4. 判断是否为阻断性测试失败
  5. 生成修复建议
```

### 步骤4: 后续操作

```yaml
有失败时:
  输出: 确认（测试结果摘要+失败列表+修复建议）
  ⛔ END_TURN
  用户确认后:
  生成修复方案: 创建 plan/YYYYMMDDHHMM_fix-tests/ 方案包
  仅记录报告: 输出完整报告
  跳过: 不执行操作

→ 状态重置
```

---

## 不确定性处理

| 场景 | 处理 |
|------|------|
| 无法检测框架 | 询问用户提供测试命令 |
| 多框架共存 | 列出选项请用户选择 |
| 测试超时 | 询问是否延长或终止 |
| 输出无法解析 | 返回原始输出，建议手动分析 |
